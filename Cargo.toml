[package]
name = "memapi"
# major will probably always be 0
version = "0.14.1"
edition = "2021"
readme = "README.md"
rust-version = "1.61.0"
description = "A no_std-friendly memory allocation interface for raw buffers, with improved error reporting."
license = "MIT OR Apache-2.0"
repository = "https://github.com/afemboylol/memapi"
keywords = ["allocator", "no_std", "memory", "allocation"]
categories = ["no-std", "memory-management"]
exclude = ["/tests", "/bin", "testall.py", "src/expanded"]

[package.metadata.docs.rs]
features = ["full"]

[badges]
maintenance = { status = "actively-developed" }
docsrs = { status = "passing" }

# TODO: docs for features

[features]
nightly = []
std = []

metadata = ["nightly"]
sized_hierarchy = ["nightly"]
clone_to_uninit = ["nightly"]
specialization = ["nightly"]

extra_const = []

c_str = []

all_nightly = ["metadata", "sized_hierarchy", "clone_to_uninit", "specialization"]

alloc_ext = []
alloc_slice = ["alloc_ext"]
resize_in_place = []

stats = []
owned = []

drop_for_owned = ["owned"]
zero_drop_for_owned = ["owned"]

external_alloc = ["cty"]

jemalloc = ["tikv-jemalloc-sys", "external_alloc"]
jemalloc_in_place = ["jemalloc", "resize_in_place"]

mimalloc = ["libmimalloc-sys", "external_alloc"]
mimalloc_in_place = ["mimalloc", "resize_in_place"]

full_no_extern_no_nightly_no_std = [
    "alloc_slice",
    "stats",
    "owned",
    "extra_const",
    "c_str",
]

full_no_std_no_nightly = [
    "jemalloc_in_place",
    "mimalloc_in_place",

    "full_no_extern_no_nightly_no_std",
]

full_no_nightly = [
    "std",

    "full_no_std_no_nightly"
]

full_no_std = [
    "all_nightly",

    "full_no_std_no_nightly",
]

full = [
    "full_no_nightly",
    "full_no_std"
]

default = ["c_str", "extra_const"]

[[test]]
name = "test"
path = "tests/test.rs"

[[test]]
name = "dangerous"
path = "tests/potential_ub.rs"

[dependencies]
tikv-jemalloc-sys = { version = "0.6.0", optional = true }
cty = { version = "0.2.2", optional = true }
libmimalloc-sys = { version = "0.1.43", optional = true, features = ["extended", "cty"] }
